Documentation WebSocket pour l'application de maaaaessagerie
1. Connexion WebSocket
URL de connexion :
wss://reseausocial-production.up.railway.app/ws/chat/


https://reseausocial-production.up.railway.app


Authentification : La connexion utilise l'authentification JWT via les subprotocols WebSocket :
javascript
const websocket = new WebSocket('wss://votre-domaine.com/ws/chat/', ['access_token', 'your_jwt_token_here']);
Message de connexion réussie :
json
{
  "type": "connection_established",
  "message": "Connecté en tant que [username]"
}
2. Types de messages envoyés par le client (frontend vers backend)
Envoyer un message
json
{
  "type": "chat_message",
  "conversation_uuid": "uuid-de-la-conversation",
  "message": "Contenu du message",
  "attachment_uuids": ["uuid1", "uuid2"] // Optionnel, pour les fichiers
}
Indiquer qu'on commence à écrire
json
{
  "type": "typing_start",
  "conversation_uuid": "uuid-de-la-conversation"
}
Indiquer qu'on arrête d'écrire
json
{
  "type": "typing_stop",
  "conversation_uuid": "uuid-de-la-conversation"
}
Marquer une conversation comme vue
json
{
  "type": "mark_as_seen",
  "conversation_uuid": "uuid-de-la-conversation"
}
Archiver une conversation
json
{
  "type": "archive_conversation",
  "conversation_uuid": "uuid-de-la-conversation"
}
Désarchiver une conversation
json
{
  "type": "unarchive_conversation",
  "conversation_uuid": "uuid-de-la-conversation"
}
3. Types de messages reçus par le client (backend vers frontend)
Nouveau message dans une conversation
json
{
  "type": "chat_message",
  "message": {
    "id": 123,
    "uuid": "message-uuid",
    "content": "Contenu du message",
    "sender_username": "nom_utilisateur",
    "sender_uuid": "uuid-sender",
    "conversation_uuid": "uuid-conversation",
    "created_at": "2025-08-28T10:30:00.000Z",
    "attachments": [
      {
        "id": 456,
        "uuid": "attachment-uuid",
        "file_type": "image",
        "original_filename": "photo.jpg",
        "file_size": 1048576,
        "file_url": "/media/attachments/photo.jpg",
        "thumbnail_url": "/media/thumbnails/photo_thumb.jpg"
      }
    ],
    "has_attachments": true
  }
}
Statut "en train d'écrire"
json
{
  "type": "typing_status",
  "username": "nom_utilisateur",
  "conversation_uuid": "uuid-conversation",
  "is_typing": true // ou false
}
Conversation marquée comme vue
json
{
  "type": "conversation_seen",
  "user_id": 123,
  "username": "nom_utilisateur",
  "user_uuid": "uuid-user",
  "conversation_uuid": "uuid-conversation",
  "seen_at": "2025-08-28T10:30:00.000Z",
  "marked_count": 5
}
Confirmation d'archivage
json
{
  "type": "conversation_archived",
  "conversation_uuid": "uuid-conversation",
  "message": "Conversation archivée"
}
Confirmation de désarchivage
json
{
  "type": "conversation_unarchived",
  "conversation_uuid": "uuid-conversation",
  "message": "Conversation désarchivée"
}
Messages d'erreur
json
{
  "type": "error",
  "message": "Description de l'erreur"
}
4. Gestion des groupes WebSocket (automatique)
Le système gère automatiquement les groupes :
* Groupe personnel : user_{user_id} - pour les notifications personnelles
* Groupes de conversations : conversation_{conversation_uuid} - l'utilisateur est automatiquement ajouté à toutes ses conversations actives
5. Gestion des attachments
Les fichiers doivent d'abord être uploadés via l'API REST, puis leurs UUIDs peuvent être utilisés dans les messages WebSocket.
Types de fichiers supportés :
* Images : JPEG, PNG, GIF, WebP
* Vidéos : MP4, WebM, QuickTime, AVI
* Audio : MP3, WAV, OGG, WebM, MP4
* Documents : PDF, TXT, DOC, DOCX
6. Codes d'erreur WebSocket
* 4001 : Non autorisé (token JWT invalide ou manquant)
* Autres fermetures : Voir les standards WebSocket






















Documentation API - Réseau Social
Base URL
https://reseausocial-production.up.railway.app
Authentification
L'API utilise JWT (JSON Web Tokens) pour l'authentification. Incluez le token dans l'en-tête Authorization:
Authorization: Bearer your_jwt_token_here


________________


🔐 AUTHENTIFICATION & UTILISATEURS
1. Inscription
POST /api/auth/register/
Envoi :
{
  "username": "string",
  "password": "string",
  "email": "string",
  "first_name": "string", // Optionnel
  "last_name": "string", // Optionnel
  "bio": "string", // Optionnel
  "date_naissance": "YYYY-MM-DD", // Optionnel
  "surnom": "string", // Optionnel
  "nationalite": "string" // Optionnel
}


Réception :
{
  "user": {
    "id": 123,
    "uuid": "uuid-string",
    "username": "string",
    "email": "string",
    "first_name": "string",
    "last_name": "string",
    "bio": "string",
    "date_naissance": "YYYY-MM-DD",
    "date_inscription": "2025-08-28T10:30:00.000Z",
    "surnom": "string",
    "nationalite": "string",
    "photo_profil": "url-ou-null",
    "photo_profil_url": "url-complete-ou-null",
    "nb_connexions": 0,
    "derniere_reponse": null,
    "prochains_evenements": []
  },
  "tokens": {
    "refresh": "refresh_token_string",
    "access": "access_token_string"
  },
  "message": "Compte créé avec succès !"
}


2. Connexion
POST /api/auth/login/
Envoi :
{
  "username": "string",
  "password": "string"
}


Réception :
{
  "access": "access_token_string",
  "refresh": "refresh_token_string",
  "user": {
    // Même structure que l'inscription
  },
  "message": "Connexion réussie !"
}


3. Déconnexion
POST /api/auth/logout/
Envoi :
{
  "refresh": "refresh_token_string"
}


Réception :
{
  "message": "Déconnexion réussie !"
}


4. Rafraîchir le token
POST /api/auth/token/refresh/
Envoi :
{
  "refresh": "refresh_token_string"
}


Réception :
{
  "access": "new_access_token_string"
}


5. Profil utilisateur connecté
GET /api/auth/profile/ PUT/PATCH /api/auth/profile/
Réception (GET) :
{
  "id": 123,
  "uuid": "uuid-string",
  "username": "string",
  "email": "string",
  "first_name": "string",
  "last_name": "string",
  "bio": "string",
  "date_naissance": "YYYY-MM-DD",
  "date_inscription": "2025-08-28T10:30:00.000Z",
  "surnom": "string",
  "nationalite": "string",
  "photo_profil": "url-ou-null",
  "photo_profil_url": "url-complete-ou-null",
  "nb_connexions": 5,
  "derniere_reponse": {
    "question": "Quel est ton plat préféré ?",
    "reponse": "Les pâtes !",
    "date": "2025-08-28T10:30:00.000Z"
  },
  "prochains_evenements": [
    {
      "id": 1,
      "titre": "Réunion équipe",
      "date_debut": "2025-08-29T14:00:00.000Z",
      "type": "professionnel"
    }
  ]
}


6. Changement de mot de passe
POST /api/auth/change-password/
Envoi :
{
  "old_password": "ancien_mot_de_passe",
  "new_password": "nouveau_mot_de_passe"
}


Réception :
{
  "message": "Mot de passe modifié avec succès"
}


7. Statistiques du profil
GET /api/auth/profile/stats/ (profil connecté) GET /api/users/{uuid}/stats/ (autre utilisateur)
Réception :
{
  "total_connexions": 15,
  "total_evenements": 8,
  "evenements_ce_mois": 3,
  "total_reponses": 12,
  "date_inscription": "2025-06-01T10:00:00.000Z",
  "derniere_activite": "2025-08-28T09:30:00.000Z"
}


8. Liste des utilisateurs
GET /api/users/
Réception :
[
  {
    "id": 123,
    "uuid": "uuid-string",
    "username": "string",
    "surnom": "string",
    "first_name": "string",
    "last_name": "string",
    "statut_relation": "aucune|en_attente|acceptee|refusee|self",
    "photo_profil_url": "url-complete-ou-null"
  }
]


9. Détail d'un utilisateur
GET /api/users/{uuid}/
Réception :
{
  // Même structure que le profil utilisateur connecté
}


________________


👥 RELATIONS/CONNEXIONS
1. Liste des relations
GET /relations/connections/ GET /relations/connections/?statut=en_attente (filtrer par statut)
Réception :
[
  {
    "id": 1,
    "demandeur": 123,
    "destinataire": 456,
    "demandeur_info": {
      "id": 123,
      "uuid": "uuid-string",
      "username": "string",
      "surnom": "string",
      "first_name": "string",
      "last_name": "string",
      "statut_relation": "en_attente",
      "photo_profil_url": "url-ou-null"
    },
    "destinataire_info": {
      // Même structure
    },
    "statut": "en_attente|acceptee|refusee",
    "message": "Message de la demande",
    "date_demande": "2025-08-28T10:30:00.000Z",
    "date_reponse": "2025-08-28T11:00:00.000Z"
  }
]


2. Créer une demande de connexion
POST /relations/connections/
Envoi :
{
  "destinataire_uuid": "uuid-du-destinataire",
  "message": "Message de la demande"
}


Réception :
{
  "id": 1,
  "demandeur": 123,
  "destinataire": 456,
  "statut": "en_attente",
  "message": "Message de la demande",
  "date_demande": "2025-08-28T10:30:00.000Z",
  "date_reponse": null
}


3. Répondre à une demande
PUT/PATCH /relations/connections/{id}/
Envoi :
{
  "statut": "acceptee|refusee"
}


Réception :
{
  // Structure complète de la relation mise à jour
}


4. Mes connexions acceptées
GET /relations/connections/my-connections/
Réception :
{
  "connexions": [
    {
      "id": 123,
      "uuid": "uuid-string",
      "username": "string",
      "surnom": "string",
      "first_name": "string",
      "last_name": "string",
      "statut_relation": "acceptee",
      "photo_profil_url": "url-ou-null"
    }
  ],
  "total": 5
}


5. Demandes reçues en attente
GET /relations/connections/pending/
Réception :
{
  "demandes": [
    // Même structure que la liste des relations
  ],
  "total": 3
}


6. Demandes envoyées
GET /relations/connections/sent/
Réception :
{
  "demandes": [
    // Même structure que la liste des relations
  ],
  "total": 2
}


________________


💬 API MESSAGING - Documentation Complète
Base URL: /api/messaging/
Note pour les LLM: Les endpoints qui servent à envoyer des messages, marquer comme vu, et gérer le statut "en train d'écrire" sont maintenant gérés par les WebSockets.
________________


📋 Table des matières
1. Liste des conversations
2. Conversations privées uniquement
3. Conversations de groupe uniquement
4. Créer une conversation
5. Rechercher des conversations
6. Détail d'une conversation
7. Messages d'une conversation
8. Envoyer un message
9. Marquer comme vu
10. Statut "en train d'écrire"
11. Messages non lus globaux
12. Résumer une conversation
13. Upload d'un attachment
14. Détail d'un attachment
15. Envoyer un message avec attachments
16. Statut de lecture d'une conversation
17. Messages non lus d'un utilisateur
18. Participants d'une conversation
19. Archiver/Désarchiver une conversation
20. Conversations archivées
________________


1. Liste des conversations
Récupère toutes les conversations de l'utilisateur (privées + groupes).
Endpoint: GET /messaging/conversations/
Headers:
Authorization: Bearer {access_token}


Réponse:
[
  {
    "id": 1,
    "uuid": "conversation-uuid",
    "last_message": {
      "content": "Dernier message...",
      "sender_username": "Alice",
      "created_at": "2025-10-13T10:30:00.000Z",
      "is_read": true
    },
    "other_participant": {
      "id": 456,
      "uuid": "uuid-string",
      "username": "Alice",
      "surnom": "string"
    },
    "unread_count": 3,
    "created_at": "2025-10-13T10:30:00.000Z",
    "updated_at": "2025-10-13T10:30:00.000Z"
  }
]


________________


2. Conversations privées uniquement
Récupère uniquement les conversations privées (1v1) de l'utilisateur.
Endpoint: GET /messaging/conversations/private/
Headers:
Authorization: Bearer {access_token}


Réponse:
[
  {
    "id": 1,
    "uuid": "conversation-uuid",
    "conversation_type": "direct",
    "last_message": {
      "content": "Dernier message...",
      "sender_username": "Alice",
      "created_at": "2025-10-13T10:30:00.000Z",
      "is_read": true
    },
    "other_participant": {
      "id": 456,
      "uuid": "uuid-string",
      "username": "Alice",
      "surnom": "string"
    },
    "unread_count": 3,
    "created_at": "2025-10-13T10:30:00.000Z",
    "updated_at": "2025-10-13T10:30:00.000Z"
  }
]


________________


3. Conversations de groupe uniquement
Récupère uniquement les conversations de groupe de l'utilisateur.
Endpoint: GET /messaging/conversations/groups/
Headers:
Authorization: Bearer {access_token}


Réponse:
[
  {
    "id": 2,
    "uuid": "group-conversation-uuid",
    "conversation_type": "group_chat",
    "last_message": {
      "content": "Message dans le groupe...",
      "sender_username": "Bob",
      "created_at": "2025-10-13T11:00:00.000Z",
      "is_read": false
    },
    "group_info": {
      "id": 10,
      "uuid": "group-uuid",
      "name": "Équipe Marketing",
      "description": "Groupe de l'équipe marketing",
      "avatar": "/media/groups/avatar.jpg",
      "member_count": 15,
      "my_role": "member"
    },
    "unread_count": 7,
    "created_at": "2025-10-13T09:00:00.000Z",
    "updated_at": "2025-10-13T11:00:00.000Z"
  }
]


Note: Le champ my_role peut être: "owner", "moderator", ou "member".
________________


4. Créer une conversation
Crée une nouvelle conversation privée ou récupère une existante.
Endpoint: POST /messaging/conversations/
Headers:
Authorization: Bearer {access_token}
Content-Type: application/json


Body:
{
  "recipient_uuid": "uuid-de-l-autre-utilisateur",
  "first_message": "Salut ! Comment ça va ?"
}


Champs:
* recipient_uuid (obligatoire): UUID de l'utilisateur destinataire
* first_message (optionnel): Premier message à envoyer
Réponse:
{
  "id": 1,
  "uuid": "conversation-uuid",
  "participants_detail": [
    {
      "user": 123,
      "username": "Alice",
      "user_uuid": "uuid-string",
      "surnom": "string",
      "last_seen": null,
      "is_typing": false,
      "joined_at": "2025-10-13T10:30:00.000Z",
      "is_archived": false,
      "archived_at": null
    },
    {
      "user": 456,
      "username": "Bob",
      "user_uuid": "uuid-string-2",
      "surnom": "Bobby",
      "last_seen": null,
      "is_typing": false,
      "joined_at": "2025-10-13T10:30:00.000Z",
      "is_archived": false,
      "archived_at": null
    }
  ],
  "messages": [
    {
      "id": 1,
      "uuid": "message-uuid",
      "sender": 123,
      "sender_username": "Alice",
      "sender_uuid": "uuid-string",
      "content": "Salut ! Comment ça va ?",
      "is_ai_generated": false,
      "is_read": false,
      "read_at": null,
      "created_at": "2025-10-13T10:30:00.000Z",
      "updated_at": "2025-10-13T10:30:00.000Z",
      "attachments": []
    }
  ],
  "my_last_seen": null,
  "created_at": "2025-10-13T10:30:00.000Z",
  "updated_at": "2025-10-13T10:30:00.000Z"
}


________________


5. Rechercher des conversations
Recherche dans les conversations de l'utilisateur.
Endpoint: GET /messaging/conversations/search/
Headers:
Authorization: Bearer {access_token}


Query Parameters:
* q: Terme de recherche
Exemple: GET /messaging/conversations/search/?q=Alice
Réponse: Même structure que la liste des conversations.
________________


6. Détail d'une conversation
Récupère tous les détails et messages d'une conversation.
Endpoint: GET /messaging/conversations/{uuid}/
Headers:
Authorization: Bearer {access_token}


Réponse:
{
  "id": 1,
  "uuid": "conversation-uuid",
  "participants_detail": [
    {
      "user": 123,
      "username": "Alice",
      "user_uuid": "uuid-string",
      "surnom": "string",
      "last_seen": "2025-10-13T10:30:00.000Z",
      "is_typing": false,
      "joined_at": "2025-10-13T10:00:00.000Z",
      "is_archived": false,
      "archived_at": null
    }
  ],
  "messages": [
    {
      "id": 1,
      "uuid": "message-uuid",
      "sender": 123,
      "sender_username": "Alice",
      "sender_uuid": "uuid-string",
      "content": "Salut !",
      "is_ai_generated": false,
      "is_read": true,
      "read_at": "2025-10-13T10:35:00.000Z",
      "created_at": "2025-10-13T10:30:00.000Z",
      "updated_at": "2025-10-13T10:30:00.000Z",
      "attachments": []
    }
  ],
  "my_last_seen": "2025-10-13T10:35:00.000Z",
  "created_at": "2025-10-13T10:00:00.000Z",
  "updated_at": "2025-10-13T10:30:00.000Z"
}


________________


7. Messages d'une conversation
Liste tous les messages d'une conversation.
Endpoint: GET /messaging/conversations/{conversation_uuid}/messages/
Headers:
Authorization: Bearer {access_token}


Query Parameters (optionnels):
* limit: Nombre de messages à retourner (par défaut: 50)
* offset: Point de départ pour la pagination
Réponse:
[
  {
    "id": 1,
    "uuid": "message-uuid",
    "sender": 123,
    "sender_username": "Alice",
    "sender_uuid": "uuid-string",
    "content": "Salut !",
    "is_ai_generated": false,
    "is_read": true,
    "read_at": "2025-10-13T10:35:00.000Z",
    "created_at": "2025-10-13T10:30:00.000Z",
    "updated_at": "2025-10-13T10:30:00.000Z",
    "attachments": [
      {
        "id": 1,
        "uuid": "attachment-uuid",
        "file_type": "image",
        "original_filename": "photo.jpg",
        "file_size": 1048576,
        "file_url": "/media/attachments/photo.jpg",
        "thumbnail_url": "/media/thumbnails/photo_thumb.jpg",
        "created_at": "2025-10-13T10:30:00.000Z"
      }
    ]
  }
]


________________


8. Envoyer un message
Envoie un nouveau message dans une conversation.
Endpoint: POST /messaging/conversations/{conversation_uuid}/messages/create/
Headers:
Authorization: Bearer {access_token}
Content-Type: application/json


Body:
{
  "content": "Contenu du message",
  "is_ai_generated": false
}


Champs:
* content (obligatoire): Contenu du message (ne peut pas être vide)
* is_ai_generated (optionnel, défaut: false): Indique si généré par IA
Réponse:
{
  "id": 1,
  "uuid": "message-uuid",
  "sender": 123,
  "sender_username": "Alice",
  "sender_uuid": "uuid-string",
  "content": "Contenu du message",
  "is_ai_generated": false,
  "is_read": false,
  "read_at": null,
  "created_at": "2025-10-13T10:30:00.000Z",
  "updated_at": "2025-10-13T10:30:00.000Z",
  "attachments": []
}


________________


9. Marquer comme vu
Marque tous les messages d'une conversation comme lus.
Endpoint: POST /messaging/conversations/{conversation_uuid}/mark-as-seen/
Headers:
Authorization: Bearer {access_token}
Content-Type: application/json


Body:
{}


Réponse:
{
  "message": "Conversation marquée comme vue",
  "marked_count": 5
}


Note: marked_count indique le nombre de messages marqués comme lus.
________________


10. Statut "en train d'écrire"
Met à jour le statut "en train d'écrire" de l'utilisateur dans une conversation.
Endpoint: POST /messaging/conversations/{conversation_uuid}/typing/
Headers:
Authorization: Bearer {access_token}
Content-Type: application/json


Body:
{
  "is_typing": true
}


Champs:
* is_typing (obligatoire): true si l'utilisateur tape, false sinon
Réponse:
{
  "message": "Statut mis à jour",
  "is_typing": true
}


________________


11. Messages non lus globaux
Récupère le nombre total de messages non lus de l'utilisateur.
Endpoint: GET /messaging/messages/unread/
Headers:
Authorization: Bearer {access_token}


Réponse:
{
  "total_unread": 15,
  "conversations": [
    {
      "conversation_uuid": "uuid-1",
      "unread_count": 5
    },
    {
      "conversation_uuid": "uuid-2",
      "unread_count": 10
    }
  ]
}


________________


12. Résumer une conversation
Génère un résumé de la conversation (probablement avec IA).
Endpoint: POST /messaging/conversations/{conversation_uuid}/summarize/
Headers:
Authorization: Bearer {access_token}
Content-Type: application/json


Body:
{}


Réponse: (À définir selon l'implémentation)
________________


13. Upload d'un attachment
Upload un fichier pour l'attacher à un message.
Endpoint: POST /messaging/attachments/upload/
Headers:
Authorization: Bearer {access_token}
Content-Type: multipart/form-data


Form Data:
* file: Le fichier binaire à uploader
Réponse:
{
  "id": 1,
  "uuid": "attachment-uuid",
  "file_type": "image",
  "original_filename": "photo.jpg",
  "file_size": 1048576,
  "file_url": "/media/attachments/photo.jpg",
  "thumbnail_url": "/media/thumbnails/photo_thumb.jpg",
  "created_at": "2025-10-13T10:30:00.000Z"
}


Types de fichiers supportés:
* image: Images (JPEG, PNG, GIF, etc.)
* video: Vidéos
* audio: Audio
* document: Documents (PDF, DOCX, etc.)
________________


14. Détail d'un attachment
Récupère les informations d'un attachment.
Endpoint: GET /messaging/attachments/{uuid}/
Headers:
Authorization: Bearer {access_token}


Réponse:
{
  "id": 1,
  "uuid": "attachment-uuid",
  "file_type": "image",
  "original_filename": "photo.jpg",
  "file_size": 1048576,
  "file_url": "/media/attachments/photo.jpg",
  "thumbnail_url": "/media/thumbnails/photo_thumb.jpg",
  "created_at": "2025-10-13T10:30:00.000Z"
}


________________


15. Envoyer un message avec attachments
Envoie un message avec des fichiers joints.
Endpoint: POST /messaging/conversations/{conversation_uuid}/messages/create-with-attachments/
Headers:
Authorization: Bearer {access_token}
Content-Type: application/json


Body:
{
  "content": "Message avec fichier joint",
  "attachment_uuids": ["attachment-uuid-1", "attachment-uuid-2"],
  "is_ai_generated": false
}


Champs:
* content (obligatoire): Contenu du message
* attachment_uuids (obligatoire): Liste des UUIDs des attachments (uploadés préalablement)
* is_ai_generated (optionnel): Indique si généré par IA
Workflow:
1. Upload les fichiers via /messaging/attachments/upload/
2. Récupérer les UUIDs des attachments
3. Créer le message avec les UUIDs
Réponse:
{
  "id": 1,
  "uuid": "message-uuid",
  "sender": 123,
  "sender_username": "Alice",
  "sender_uuid": "uuid-string",
  "content": "Message avec fichier joint",
  "is_ai_generated": false,
  "is_read": false,
  "read_at": null,
  "created_at": "2025-10-13T10:30:00.000Z",
  "updated_at": "2025-10-13T10:30:00.000Z",
  "attachments": [
    {
      "id": 1,
      "uuid": "attachment-uuid-1",
      "file_type": "image",
      "original_filename": "photo.jpg",
      "file_size": 1048576,
      "file_url": "/media/attachments/photo.jpg",
      "thumbnail_url": "/media/thumbnails/photo_thumb.jpg",
      "created_at": "2025-10-13T10:30:00.000Z"
    }
  ]
}


________________


16. Statut de lecture d'une conversation
Récupère le statut de lecture pour tous les participants.
Endpoint: GET /messaging/conversations/{conversation_uuid}/read-status/
Headers:
Authorization: Bearer {access_token}


Réponse:
{
  "conversation_uuid": "conversation-uuid",
  "participants": [
    {
      "user_id": 123,
      "username": "Alice",
      "last_seen": "2025-10-13T10:35:00.000Z",
      "unread_count": 0
    },
    {
      "user_id": 456,
      "username": "Bob",
      "last_seen": "2025-10-13T10:20:00.000Z",
      "unread_count": 3
    }
  ]
}


________________


17. Messages non lus d'un utilisateur
Récupère les messages non lus d'un utilisateur spécifique dans une conversation.
Endpoint: GET /messaging/conversations/{conversation_uuid}/unread-messages/{user_uuid}/
Headers:
Authorization: Bearer {access_token}


Réponse:
{
  "conversation_uuid": "conversation-uuid",
  "user_uuid": "user-uuid",
  "unread_count": 3,
  "unread_messages": [
    {
      "id": 1,
      "uuid": "message-uuid",
      "content": "Message non lu 1",
      "sender_username": "Alice",
      "created_at": "2025-10-13T10:30:00.000Z"
    }
  ]
}


________________


18. Participants d'une conversation
Liste tous les participants d'une conversation avec leurs statuts.
Endpoint: GET /messaging/conversations/{conversation_uuid}/participants/
Headers:
Authorization: Bearer {access_token}


Réponse:
{
  "conversation_uuid": "conversation-uuid",
  "participants": [
    {
      "user_id": 123,
      "user_uuid": "uuid-string",
      "username": "Alice",
      "surnom": "string",
      "last_seen": "2025-10-13T10:30:00.000Z",
      "is_typing": false,
      "joined_at": "2025-10-13T10:00:00.000Z",
      "unread_count": 0
    }
  ]
}


________________


19. Archiver/Désarchiver une conversation
Archive ou désarchive une conversation pour l'utilisateur.
Endpoint: POST /messaging/conversations/{uuid}/archive/
Headers:
Authorization: Bearer {access_token}
Content-Type: application/json


Body pour archiver:
{
  "action": "archive"
}


Body pour désarchiver:
{
  "action": "unarchive"
}


Réponse (archiver):
{
  "message": "Conversation archivée avec succès"
}


Réponse (désarchiver):
{
  "message": "Conversation désarchivée avec succès"
}


________________


20. Conversations archivées
Liste toutes les conversations archivées de l'utilisateur.
Endpoint: GET /messaging/conversations/archived/
Headers:
Authorization: Bearer {access_token}


Réponse:
[
  {
    "id": 1,
    "uuid": "conversation-uuid",
    "last_message": {
      "content": "Dernier message...",
      "sender_username": "Alice",
      "created_at": "2025-10-13T10:30:00.000Z",
      "is_read": true
    },
    "other_participant": {
      "id": 456,
      "uuid": "uuid-string",
      "username": "Alice",
      "surnom": "string"
    },
    "unread_count": 0,
    "created_at": "2025-10-13T10:00:00.000Z",
    "updated_at": "2025-10-13T10:30:00.000Z",
    "archived_at": "2025-10-13T12:00:00.000Z"
  }
]


________________


📝 Notes importantes
Types de conversations
* direct: Conversation privée entre 2 utilisateurs
* group_chat: Conversation de groupe (3+ utilisateurs)
Authentification
Tous les endpoints nécessitent un token JWT valide dans le header:
Authorization: Bearer {access_token}


Pagination
Certains endpoints supportent la pagination via les paramètres:
* limit: Nombre d'éléments par page
* offset: Point de départ
WebSockets
Les fonctionnalités temps réel (messages instantanés, statut typing, etc.) sont gérées via WebSockets pour une meilleure performance.
Gestion des erreurs
Codes de statut HTTP courants:
* 200: Succès
* 201: Créé avec succès
* 400: Requête invalide
* 401: Non authentifié
* 403: Non autorisé
* 404: Ressource non trouvée
* 500: Erreur serveur


________________


👤 PROFILS & QUESTIONS
1. Liste des questions disponibles
GET /profiles/questions/ GET /profiles/questions/?categorie=alimentation (filtrer par catégorie)
Réception :
[
  {
    "id": 1,
    "question": "Quel est ton plat préféré ?",
    "categorie": "alimentation",
    "is_active": true,
    "date_creation": "2025-08-28T10:30:00.000Z"
  }
]


2. Mes réponses
GET /profiles/responses/
Réception :
[
  {
    "id": 1,
    "utilisateur": 123,
    "question": {
      "id": 1,
      "question": "Quel est ton plat préféré ?",
      "categorie": "alimentation"
    },
    "reponse": "Les pâtes carbonara !",
    "date_reponse": "2025-08-28T10:30:00.000Z",
    "date_modification": "2025-08-28T10:35:00.000Z"
  }
]


3. Créer une réponse
POST /profiles/responses/
Envoi :
{
  "question_id": 1,
  "reponse": "Les pâtes carbonara !"
}


Réception :
{
  "id": 1,
  "utilisateur": 123,
  "question": 1,
  "reponse": "Les pâtes carbonara !",
  "date_reponse": "2025-08-28T10:30:00.000Z",
  "date_modification": "2025-08-28T10:30:00.000Z"
}


4. Modifier/supprimer une réponse
PUT/PATCH/DELETE /profiles/responses/{id}/
Envoi (PUT/PATCH) :
{
  "reponse": "Nouvelle réponse modifiée"
}


Réception :
{
  // Même structure qu'à la création, avec les données mises à jour
}


5. Réponses d'un autre utilisateur
GET /profiles/users/{uuid}/responses/
Réception :
[
  {
    // Même structure que "Mes réponses"
  }
]


________________


📅 CALENDRIER
1. Liste de mes événements
GET /calendrier/events/ GET /calendrier/events/?date_debut=2025-08-28 (filtrer par date) GET /calendrier/events/?type=anniversaire (filtrer par type)
Réception :
[
  {
    "id": 1,
    "titre": "Réunion équipe",
    "description": "Réunion hebdomadaire",
    "date_debut": "2025-08-29T14:00:00.000Z",
    "date_fin": "2025-08-29T15:00:00.000Z",
    "type": "professionnel",
    "lieu": "Salle de conférence",
    "is_all_day": false,
    "rappel_minutes": 15,
    "created_at": "2025-08-28T10:30:00.000Z",
    "updated_at": "2025-08-28T10:30:00.000Z"
  }
]


2. Créer un événement
POST /calendrier/events/
Envoi :
{
  "titre": "Réunion équipe",
  "description": "Réunion hebdomadaire",
  "date_debut": "2025-08-29T14:00:00.000Z",
  "date_fin": "2025-08-29T15:00:00.000Z",
  "type": "professionnel",
  "lieu": "Salle de conférence",
  "is_all_day": false,
  "rappel_minutes": 15
}


Réception :
{
  "id": 1,
  "titre": "Réunion équipe",
  "description": "Réunion hebdomadaire",
  "date_debut": "2025-08-29T14:00:00.000Z",
  "date_fin": "2025-08-29T15:00:00.000Z",
  "type": "professionnel",
  "lieu": "Salle de conférence",
  "is_all_day": false,
  "rappel_minutes": 15,
  "created_at": "2025-08-28T10:30:00.000Z",
  "updated_at": "2025-08-28T10:30:00.000Z"
}


3. Détail/Modifier/Supprimer un événement
GET/PUT/PATCH/DELETE /calendrier/events/{id}/
Réception (GET) :
{
  // Même structure que la création
}


4. Événements du jour
GET /calendrier/day/?date=2025-08-28
Réception :
{
  "date": "2025-08-28",
  "events": [
    {
      // Structure des événements
    }
  ],
  "total": 3
}


5. Événements du mois
GET /calendrier/month/?year=2025&month=8
Réception :
{
  "year": 2025,
  "month": 8,
  "events": [
    {
      // Structure des événements
    }
  ],
  "total": 15
}


6. Événements à venir
GET /calendrier/upcoming/
Réception :
{
  "upcoming_events": [
    {
      // Structure des événements
    }
  ],
  "total": 8
}


________________


🔍 RECHERCHE
1. Rechercher des conversations
GET /messaging/conversations/search/?q=mot_recherche
Réception :
[
  {
    // Structure des conversations avec correspondances trouvées
  }
]


________________


❌ CODES D'ERREUR
Codes de statut HTTP courants :
* 200 : Succès
* 201 : Créé avec succès
* 400 : Erreur de validation des données
* 401 : Non authentifié (token manquant/invalide)
* 403 : Interdit (pas d'autorisation)
* 404 : Ressource non trouvée
* 500 : Erreur serveur
Format des erreurs :
{
  "error": "Description de l'erreur",
  "details": "Détails supplémentaires optionnels"
}


________________


📝 NOTES IMPORTANTES
Types de fichiers supportés :
* Images : JPEG, PNG, GIF, WebP
* Vidéos : MP4, WebM, QuickTime, AVI
* Audio : MP3, WAV, OGG, WebM, MP4
* Documents : PDF, TXT, DOC, DOCX
Pagination :
La plupart des endpoints de liste supportent la pagination standard de Django REST Framework.
Filtrage :
Beaucoup d'endpoints supportent des paramètres de requête pour filtrer les résultats (voir exemples dans chaque section).
WebSocket :
Voir la documentation WebSocket séparée pour les fonctionnalités temps réel (messages, statut typing, etc.).




👥 GROUPES
1. Mes groupes
GET /groups/my-groups/
Réception :
json
[
  {
    "id": 1,
    "uuid": "group-uuid",
    "name": "Mon Groupe",
    "description": "Description du groupe",
    "avatar": "url-ou-null",
    "parent": null, // UUID du groupe parent si sous-groupe
    "member_count": 15,
    "my_role": "owner|moderator|member",
    "subgroups_count": 3,
    "unread_messages": 5,
    "created_at": "2025-08-28T10:30:00.000Z"
  }
]
2. Créer un groupe
POST /groups/create/
Envoi :
json
{
  "name": "Mon Nouveau Groupe",
  "description": "Description du groupe",
  "parent_uuid": null, // UUID du groupe parent pour créer un sous-groupe
  "max_members": 50, // Optionnel
  "avatar": null // Optionnel
}
Réception :
json
{
  "id": 1,
  "uuid": "group-uuid",
  "name": "Mon Nouveau Groupe",
  "description": "Description du groupe",
  "avatar": null,
  "invite_code": "ABC12345",
  "parent": null,
  "max_members": 50,
  "member_count": 1,
  "created_by": 123,
  "created_at": "2025-08-28T10:30:00.000Z",
  "members": [
    {
      "id": 1,
      "user": 123,
      "username": "Alice",
      "user_uuid": "user-uuid",
      "surnom": "string",
      "role": "owner",
      "is_muted": false,
      "is_banned": false,
      "joined_at": "2025-08-28T10:30:00.000Z",
      "photo_profil_url": "url-ou-null"
    }
  ],
  "subgroups": [],
  "conversation_uuid": "conversation-uuid"
}
3. Détail d'un groupe
GET /groups/{uuid}/
Réception :
json
{
  "id": 1,
  "uuid": "group-uuid",
  "name": "Mon Groupe",
  "description": "Description du groupe",
  "avatar": "url-ou-null",
  "invite_code": "ABC12345",
  "parent": null,
  "max_members": 50,
  "member_count": 15,
  "created_by": 123,
  "created_at": "2025-08-28T10:30:00.000Z",
  "members": [
    {
      "id": 1,
      "user": 123,
      "username": "Alice",
      "user_uuid": "user-uuid",
      "surnom": "string",
      "role": "owner",
      "is_muted": false,
      "is_banned": false,
      "joined_at": "2025-08-28T10:30:00.000Z",
      "photo_profil_url": "url-ou-null"
    }
  ],
  "subgroups": [
    {
      "id": 2,
      "uuid": "subgroup-uuid",
      "name": "Sous-groupe",
      "description": "Description",
      "member_count": 5
    }
  ],
  "my_membership": {
    "id": 1,
    "role": "owner",
    "is_muted": false,
    "is_banned": false,
    "joined_at": "2025-08-28T10:30:00.000Z"
  },
  "conversation_uuid": "conversation-uuid"
}
4. Modifier un groupe
PUT/PATCH /groups/{uuid}/
Envoi :
json
{
  "name": "Nouveau nom",
  "description": "Nouvelle description",
  "max_members": 100
}
Réception :
json
{
  // Structure complète du groupe mis à jour
}
5. Supprimer un groupe
DELETE /groups/{uuid}/
Réception :
json
{
  "message": "Groupe supprimé avec succès"
}
6. Membres d'un groupe
GET /groups/{group_uuid}/members/
Réception :
json
[
  {
    "id": 1,
    "user": 123,
    "username": "Alice",
    "user_uuid": "user-uuid",
    "surnom": "string",
    "role": "owner|moderator|member",
    "is_muted": false,
    "is_banned": false,
    "joined_at": "2025-08-28T10:30:00.000Z",
    "photo_profil_url": "url-ou-null",
    "invited_by": 456
  }
]
7. Modérer un membre
PUT/PATCH /groups/{group_uuid}/members/{user_uuid}/
Envoi :
json
{
  "role": "moderator|member", // Ne peut pas changer vers owner
  "is_muted": true,
  "muted_until": "2025-08-30T10:30:00.000Z", // Optionnel
  "is_banned": false,
  "ban_reason": "Raison du ban" // Si is_banned=true
}
Réception :
json
{
  // Structure complète du membre mis à jour
}
8. Quitter un groupe
POST /groups/{group_uuid}/leave/
Envoi :
json
{}
Réception :
json
{
  "message": "Vous avez quitté le groupe avec succès"
}
9. Transférer la propriété
POST /groups/{group_uuid}/transfer-ownership/
Envoi :
json
{
  "new_owner_uuid": "uuid-du-nouveau-proprietaire"
}
Réception :
json
{
  "message": "Propriété transférée avec succès",
  "new_owner": {
    "uuid": "user-uuid",
    "username": "Bob"
  }
}
10. Inviter quelqu'un dans un groupe
POST /groups/{group_uuid}/invite/
Envoi :
json
{
  "user_uuid": "uuid-de-l-utilisateur",
  "message": "Message d'invitation personnalisé"
}
Réception :
json
{
  "id": 1,
  "uuid": "invitation-uuid",
  "group": "group-uuid",
  "target_user": "user-uuid",
  "invitation_type": "official",
  "status": "sent",
  "message": "Message d'invitation personnalisé",
  "created_at": "2025-08-28T10:30:00.000Z",
  "expires_at": "2025-09-04T10:30:00.000Z"
}
11. Mes invitations reçues
GET /groups/invitations/received/
Réception :
json
[
  {
    "id": 1,
    "uuid": "invitation-uuid",
    "group": {
      "uuid": "group-uuid",
      "name": "Nom du groupe",
      "description": "Description",
      "member_count": 15
    },
    "created_by": {
      "uuid": "user-uuid",
      "username": "Alice",
      "photo_profil_url": "url-ou-null"
    },
    "invitation_type": "official|member_request",
    "status": "sent|viewed|pending|accepted|declined|expired",
    "message": "Message d'invitation",
    "created_at": "2025-08-28T10:30:00.000Z",
    "expires_at": "2025-09-04T10:30:00.000Z"
  }
]
12. Preview d'un groupe via invitation
GET /groups/invitations/{invitation_uuid}/preview/
Réception :
json
{
  "group": {
    "id": 1,
    "uuid": "group-uuid",
    "name": "Nom du groupe",
    "description": "Description du groupe",
    "avatar": "url-ou-null",
    "member_count": 15,
    "created_by": {
      "uuid": "user-uuid",
      "username": "Alice",
      "photo_profil_url": "url-ou-null"
    },
    "created_at": "2025-08-28T10:30:00.000Z",
    "members": [
      {
        // Aperçu des membres (premiers membres visibles)
      }
    ],
    "subgroups": [
      {
        "uuid": "subgroup-uuid",
        "name": "Sous-groupe",
        "description": "Description",
        "member_count": 5
      }
    ]
  },
  "invitation": {
    // Détails de l'invitation
  }
}
13. Répondre à une invitation
POST /groups/invitations/{invitation_uuid}/respond/
Envoi :
json
{
  "action": "accept|decline"
}
Réception (si accept) :
json
{
  "message": "Vous avez rejoint le groupe Mon Groupe",
  "membership": {
    "id": 15,
    "user": 123,
    "role": "member",
    "joined_at": "2025-08-28T10:30:00.000Z"
  }
}
Réception (si decline) :
json
{
  "message": "Invitation déclinée"
}
14. Preview d'un groupe via code d'invitation
GET /groups/preview/?code=ABC12345
Réception :
json
{
  "group": {
    // Même structure que preview via invitation
  },
  "can_join": true
}
15. Rejoindre un groupe via code
POST /groups/join-by-code/
Envoi :
json
{
  "invite_code": "ABC12345",
  "message": "Message de demande d'adhésion"
}
Réception :
json
{
  "message": "Votre demande pour rejoindre Mon Groupe a été envoyée aux modérateurs",
  "invitation": {
    "id": 1,
    "uuid": "invitation-uuid",
    "invitation_type": "member_request",
    "status": "pending",
    "message": "Message de demande d'adhésion",
    "created_at": "2025-08-28T10:30:00.000Z"
  }
}
16. Demandes d'adhésion en attente (modérateurs)
GET /groups/{group_uuid}/pending-approvals/
Réception :
json
[
  {
    "id": 1,
    "uuid": "invitation-uuid",
    "target_user": {
      "uuid": "user-uuid",
      "username": "Bob",
      "photo_profil_url": "url-ou-null"
    },
    "invitation_type": "member_request",
    "status": "pending",
    "message": "J'aimerais rejoindre votre groupe",
    "created_at": "2025-08-28T10:30:00.000Z",
    "expires_at": "2025-09-04T10:30:00.000Z"
  }
]
17. Approuver une demande d'adhésion
POST /groups/{group_uuid}/approve/{invitation_uuid}/
Envoi :
json
{
  "action": "approve|reject"
}
Réception (si approve) :
json
{
  "message": "Demande approuvée, Bob a rejoint le groupe",
  "new_member": {
    "id": 20,
    "user": 456,
    "username": "Bob",
    "role": "member",
    "joined_at": "2025-08-28T10:30:00.000Z"
  }
}
18. Statistiques d'un groupe
GET /groups/{group_uuid}/stats/
Réception :
json
{
  "group_uuid": "group-uuid",
  "member_count": 25,
  "subgroups_count": 3,
  "pending_invitations": 5,
  "recent_activity": {
    "new_members_this_week": 3,
    "messages_today": 12
  },
  "top_contributors": [
    {
      "username": "Alice",
      "message_count": 45
    }
  ]
}
19. Régénérer le code d'invitation
POST /groups/{uuid}/regenerate-code/
Envoi :
json
{}
Réception :
json
{
  "message": "Code d'invitation régénéré",
  "new_invite_code": "XYZ98765"
}
20. Historique de modération
GET /groups/{group_uuid}/moderation-logs/
Réception :
json
[
  {
    "id": 1,
    "action": "member_banned|member_muted|member_promoted|member_demoted",
    "moderator": {
      "uuid": "user-uuid",
      "username": "Admin"
    },
    "target_user": {
      "uuid": "user-uuid",
      "username": "Bob"
    },
    "reason": "Raison de l'action",
    "created_at": "2025-08-28T10:30:00.000Z"
  }
]






📘 Documentation API - Module ai_agent


## Table des matières
1. [Vue d'ensemble](#vue-densemble)
2. [Authentification](#authentification)
3. [Gestion des Agents](#gestion-des-agents)
4. [Règles d'interaction](#règles-dinteraction)
5. [Historique des réponses](#historique-des-réponses)
6. [Agents dans les conversations](#agents-dans-les-conversations)
7. [Endpoints utilitaires](#endpoints-utilitaires)
8. [Modèles de données](#modèles-de-données)
9. [Codes d'erreur](#codes-derreur)


---


## Vue d'ensemble


Le module **ai_agent** permet de créer et gérer des agents IA qui peuvent participer automatiquement aux conversations. Les agents peuvent avoir différents types de comportement et règles d'interaction.


**Base URL:** Toutes les URLs sont préfixées par `/agents/` . Certaines url ont donc /agents/agents/… ou /agents/conversations/….
---


## Authentification


Toutes les API nécessitent une authentification JWT. Les headers doivent contenir :
```
Authorization: Bearer <votre_access_token>
```


---


## Gestion des Agents


### 1. Liste des agents de l'utilisateur


**Endpoint:** `GET /agents/agents/`


**Description:** Récupère tous les agents créés par l'utilisateur authentifié.


**Headers requis:**
```
Authorization: Bearer <access_token>
```


**Paramètres:** Aucun


**Réponse réussie (200 OK):**
```json
[
  {
    "uuid": "123e4567-e89b-12d3-a456-426614174000",
    "name": "Assistant Marketing",
    "description": "Agent spécialisé dans le marketing digital",
    "avatar": "http://example.com/media/agents/avatars/agent1.jpg",
    "agent_type": "simple",
    "is_active": true,
    "created_at": "2025-10-10T14:30:00Z",
    "created_by_username": "john_doe",
    "conversation_count": 3
  }
]
```


**Champs de réponse:**
- `uuid`: Identifiant unique de l'agent
- `name`: Nom de l'agent
- `description`: Description de l'agent
- `avatar`: URL de l'image de l'agent (peut être null)
- `agent_type`: Type d'agent (`simple`, `conditional`, `action`)
- `is_active`: Si l'agent est actif ou non
- `created_at`: Date de création
- `created_by_username`: Nom d'utilisateur du créateur
- `conversation_count`: Nombre de conversations où l'agent est présent


---


### 2. Créer un nouvel agent


**Endpoint:** `POST/agents /agents/`


**Description:** Crée un nouvel agent IA pour l'utilisateur authentifié.


**Headers requis:**
```
Authorization: Bearer <access_token>
Content-Type: application/json
```


**Body (JSON):**
```json
{
  "name": "Mon Agent",
  "description": "Description de mon agent",
  "agent_type": "simple",
  "instructions": {
    "system_prompt": "Tu es un assistant serviable qui répond en français.",
    "language": "fr",
    "formality_level": "casual",
    "max_response_length": 500
  }
}
```


**Champs obligatoires:**
- `name` (string, max 100 caractères): Nom de l'agent


**Champs optionnels:**
- `description` (string, max 500 caractères): Description
- `agent_type` (string): Type d'agent - valeurs possibles:
  - `"simple"`: Agent qui répond à tous les messages (défaut)
  - `"conditional"`: Agent qui répond selon des règles
  - `"action"`: Agent qui peut effectuer des actions
- `instructions` (objet): Instructions pour l'agent
  - `system_prompt` (string): Prompt système pour l'IA
  - `language` (string): Langue (`"fr"`, `"en"`, `"es"`, `"de"`, `"it"`) - défaut: `"fr"`
  - `formality_level` (string): Niveau de formalité (`"formal"`, `"casual"`, `"friendly"`, `"professional"`) - défaut: `"casual"`
  - `max_response_length` (integer): Longueur max des réponses en caractères - défaut: 500


**Réponse réussie (201 Created):**
```json
{
  "uuid": "345e6789-e89b-12d3-a456-426614174002",
  "name": "Mon Agent",
  "description": "Description de mon agent",
  "avatar": null,
  "agent_type": "simple",
  "instructions": {
    "system_prompt": "Tu es un assistant serviable qui répond en français.",
    "language": "fr",
    "formality_level": "casual",
    "max_response_length": 500,
    "created_at": "2025-10-13T10:30:00Z",
    "updated_at": "2025-10-13T10:30:00Z"
  }
}
```


**Erreurs possibles:**
- `400 Bad Request`: Données invalides
- `401 Unauthorized`: Token manquant ou invalide


---


### 3. Détails d'un agent


**Endpoint:** `GET /agents/agents/{uuid}/`


**Description:** Récupère les détails complets d'un agent spécifique.


**Headers requis:**
```
Authorization: Bearer <access_token>
```


**Paramètres URL:**
- `uuid`: UUID de l'agent


**Réponse réussie (200 OK):**
```json
{
  "uuid": "123e4567-e89b-12d3-a456-426614174000",
  "name": "Assistant Marketing",
  "description": "Agent spécialisé dans le marketing digital",
  "avatar": "http://example.com/media/agents/avatars/agent1.jpg",
  "agent_type": "simple",
  "is_active": true,
  "created_at": "2025-10-10T14:30:00Z",
  "updated_at": "2025-10-12T16:45:00Z",
  "created_by_username": "john_doe",
  "instructions": {
    "system_prompt": "Tu es un expert en marketing digital.",
    "language": "fr",
    "formality_level": "professional",
    "max_response_length": 500,
    "created_at": "2025-10-10T14:30:00Z",
    "updated_at": "2025-10-12T16:45:00Z"
  },
  "interaction_rules": [
    {
      "id": 1,
      "interaction_type": "respond_to",
      "target_user": 5,
      "target_agent": null,
      "target_user_username": "alice",
      "target_agent_name": null,
      "created_at": "2025-10-11T10:00:00Z"
    }
  ],
  "recent_responses": [
    {
      "id": 42,
      "response_content": "Voici quelques idées de campagne...",
      "processing_time": 1.23,
      "created_at": "2025-10-13T09:15:00Z",
      "was_sent": true,
      "error_message": "",
      "triggered_by_message": 156
    }
  ],
  "conversation_count": 3
}
```


**Erreurs possibles:**
- `404 Not Found`: Agent introuvable ou vous n'en êtes pas le créateur
- `401 Unauthorized`: Token manquant ou invalide


---


### 4. Modifier un agent


**Endpoint:** `PUT/agents /agents/{uuid}/` ou `PATCH /agents/{uuid}/`


**Description:** Met à jour un agent existant. PUT nécessite tous les champs, PATCH permet une mise à jour partielle.


**Headers requis:**
```
Authorization: Bearer <access_token>
Content-Type: application/json
```


**Paramètres URL:**
- `uuid`: UUID de l'agent


**Body (JSON) - Exemple PATCH:**
```json
{
  "name": "Assistant Marketing v2",
  "is_active": true,
  "instructions": {
    "system_prompt": "Tu es un expert senior en marketing digital.",
    "formality_level": "professional"
  }
}
```


**Champs modifiables:**
- `name` (string)
- `description` (string)
- `avatar` (image file - utiliser multipart/form-data)
- `agent_type` (string)
- `is_active` (boolean)
- `instructions` (objet - mise à jour partielle possible)


**Réponse réussie (200 OK):** Même structure que GET d'un agent détaillé


**Erreurs possibles:**
- `400 Bad Request`: Données invalides
- `404 Not Found`: Agent introuvable
- `401 Unauthorized`: Token manquant ou invalide


---


### 5. Désactiver un agent


**Endpoint:** `DELETE /agents/agents/{uuid}/`


**Description:** Désactive un agent (ne le supprime pas vraiment, met `is_active` à `false`).


**Headers requis:**
```
Authorization: Bearer <access_token>
```


**Paramètres URL:**
- `uuid`: UUID de l'agent


**Réponse réussie (204 No Content):** Pas de contenu


**Erreurs possibles:**
- `404 Not Found`: Agent introuvable
- `401 Unauthorized`: Token manquant ou invalide


---


### 6. Liste des agents publics


**Endpoint:** `GET /agents/agents/public/`


**Description:** Récupère la liste de tous les agents actifs (pour usage futur).


**Headers requis:**
```
Authorization: Bearer <access_token>
```


**Réponse réussie (200 OK):** Même structure que la liste des agents


**Note:** Cette API est prévue pour un système de partage d'agents publics dans le futur.


---


## Règles d'interaction


Les règles d'interaction définissent comment un agent doit se comporter vis-à-vis d'utilisateurs ou d'autres agents spécifiques.


### 7. Liste des règles d'interaction d'un agent


**Endpoint:** `GET/agents /agents/{uuid}/interactions/`


**Description:** Récupère toutes les règles d'interaction configurées pour un agent.


**Headers requis:**
```
Authorization: Bearer <access_token>
```


**Paramètres URL:**
- `uuid`: UUID de l'agent


**Réponse réussie (200 OK):**
```json
[
  {
    "id": 1,
    "interaction_type": "respond_to",
    "target_user": 5,
    "target_agent": null,
    "target_user_username": "alice",
    "target_agent_name": null,
    "created_at": "2025-10-11T10:00:00Z"
  }
]
```


**Types d'interaction possibles:**
- `"respond_to"`: L'agent répond aux messages de cette cible
- `"ignore"`: L'agent ignore complètement cette cible
- `"mention_only"`: L'agent répond uniquement si mentionné par cette cible (avec @nom_agent)
- `"always_respond"`: L'agent répond toujours à cette cible


---


### 8. Créer une règle d'interaction


**Endpoint:** `POST/agents /agents/{uuid}/interactions/`


**Description:** Crée une nouvelle règle d'interaction pour un agent.


**Headers requis:**
```
Authorization: Bearer <access_token>
Content-Type: application/json
```


**Paramètres URL:**
- `uuid`: UUID de l'agent


**Body (JSON):**
```json
{
  "interaction_type": "always_respond",
  "target_user_uuid": "474df5b3-b4e4-46bb-ae54-57eb9365e37d"
}
```


**Champs obligatoires:**
- `interaction_type` (string): Type d'interaction (voir types ci-dessus)
- Soit `target_user_uuid` (UUID utilisateur), soit `target_agent_uuid` (UUID agent) - **pas les deux**


**Réponse réussie (201 Created):**
```json
{
  "id": 4,
  "interaction_type": "always_respond",
  "target_user": 5,
  "target_agent": null,
  "target_user_username": "alice",
  "target_agent_name": null,
  "created_at": "2025-10-13T10:45:00Z"
}
```


**Erreurs possibles:**
- `400 Bad Request`:
  - Les deux champs `target_user_uuid` et `target_agent_uuid` sont renseignés
  - Aucun des deux n'est renseigné
  - Règle en doublon (déjà existante pour cette cible)
  - UUID utilisateur ou agent introuvable
- `404 Not Found`: Agent introuvable


---


### 9. Détails d'une règle d'interaction


**Endpoint:** `GET /agents/agents/{uuid}/interactions/{id}/`


**Description:** Récupère les détails d'une règle d'interaction spécifique.


**Headers requis:**
```
Authorization: Bearer <access_token>
```


**Paramètres URL:**
- `uuid`: UUID de l'agent
- `id`: ID de la règle d'interaction


**Réponse réussie (200 OK):** Même structure que la création d'une règle


---


### 10. Modifier une règle d'interaction


**Endpoint:** `PUT/agents /agents/{uuid}/interactions/{id}/` ou `PATCH /agents/{uuid}/interactions/{id}/`


**Description:** Met à jour une règle d'interaction existante.


**Headers requis:**
```
Authorization: Bearer <access_token>
Content-Type: application/json
```


**Body (JSON):**
```json
{
  "interaction_type": "always_respond"
}
```


**Réponse réussie (200 OK):** Règle mise à jour


---


### 11. Supprimer une règle d'interaction


**Endpoint:** `DELETE /agents/agents/{uuid}/interactions/{id}/`


**Description:** Supprime une règle d'interaction.


**Headers requis:**
```
Authorization: Bearer <access_token>
```


**Réponse réussie (204 No Content):** Pas de contenu


---


## Historique des réponses


### 12. Historique des réponses d'un agent


**Endpoint:** `GET /agents/agents/{uuid}/responses/`


**Description:** Récupère l'historique de toutes les réponses générées par un agent.


**Headers requis:**
```
Authorization: Bearer <access_token>
```


**Paramètres URL:**
- `uuid`: UUID de l'agent


**Réponse réussie (200 OK):**
```json
[
  {
    "id": 42,
    "response_content": "Voici quelques idées de campagne marketing...",
    "processing_time": 1.23,
    "created_at": "2025-10-13T09:15:00Z",
    "was_sent": true,
    "error_message": "",
    "triggered_by_message": 156
  }
]
```


**Champs de réponse:**
- `id`: ID de la réponse
- `response_content`: Contenu de la réponse générée
- `processing_time`: Temps de traitement en secondes
- `created_at`: Date de création
- `was_sent`: `true` si la réponse a été envoyée, `false` sinon
- `error_message`: Message d'erreur (vide si pas d'erreur)
- `triggered_by_message`: ID du message qui a déclenché cette réponse


---


## Agents dans les conversations


### 13. Liste des agents dans une conversation


**Endpoint:** `GET /agents/conversations/{conversation_uuid}/agents/`


**Description:** Récupère la liste de tous les agents actifs dans une conversation.


**Headers requis:**
```
Authorization: Bearer <access_token>
```


**Paramètres URL:**
- `conversation_uuid`: UUID de la conversation


**Réponse réussie (200 OK):**
```json
{
  "id": 15,
  "agents": [
    {
      "uuid": "123e4567-e89b-12d3-a456-426614174000",
      "name": "Assistant Marketing",
      "description": "Agent spécialisé dans le marketing",
      "avatar": "http://example.com/media/agents/avatars/agent1.jpg",
      "agent_type": "simple",
      "is_active": true
    }
  ],
  "active_agents_count": 1
}
```


**Erreurs possibles:**
- `404 Not Found`: Conversation introuvable ou vous n'êtes pas participant
- `401 Unauthorized`: Token invalide


---


### 14. Ajouter un agent à une conversation


**Endpoint:** `POST /agents/conversations/{conversation_uuid}/agents/add/`


**Description:** Ajoute un agent à une conversation. Limite de 5 agents maximum par conversation.


**Headers requis:**
```
Authorization: Bearer <access_token>
Content-Type: application/json
```


**Paramètres URL:**
- `conversation_uuid`: UUID de la conversation


**Body (JSON):**
```json
{
  "agent_uuid": "123e4567-e89b-12d3-a456-426614174000"
}
```


**Champs obligatoires:**
- `agent_uuid` (string): UUID de l'agent à ajouter


**Réponse réussie (200 OK):**
```json
{
  "message": "Agent 'Assistant Marketing' ajouté à la conversation.",
  "agent": {
    "uuid": "123e4567-e89b-12d3-a456-426614174000",
    "name": "Assistant Marketing",
    "description": "Agent spécialisé dans le marketing",
    "avatar": "http://example.com/media/agents/avatars/agent1.jpg",
    "agent_type": "simple",
    "is_active": true
  }
}
```


**Erreurs possibles:**
- `400 Bad Request`:
  - Agent UUID manquant ou invalide
  - Limite d'agents atteinte (5 max)
  - Agent non actif
- `403 Forbidden`: Vous ne pouvez pas utiliser cet agent (pas le créateur)
- `404 Not Found`: Conversation ou agent introuvable


---


### 15. Retirer un agent d'une conversation


**Endpoint:** `POST/agents /conversations/{conversation_uuid}/agents/remove/`


**Description:** Retire un agent d'une conversation.


**Headers requis:**
```
Authorization: Bearer <access_token>
Content-Type: application/json
```


**Paramètres URL:**
- `conversation_uuid`: UUID de la conversation


**Body (JSON):**
```json
{
  "agent_uuid": "123e4567-e89b-12d3-a456-426614174000"
}
```


**Réponse réussie (200 OK):**
```json
{
  "message": "Agent 'Assistant Marketing' retiré de la conversation."
}
```


**Erreurs possibles:**
- `404 Not Found`:
  - Conversation introuvable
  - Agent introuvable
  - Agent pas dans cette conversation
- `400 Bad Request`: Agent UUID invalide


---


## Endpoints utilitaires


### 16. Mes agents disponibles pour conversation


**Endpoint:** `GET /agents/agents/my-available/`


**Description:** Liste de tous les agents actifs de l'utilisateur disponibles pour être ajoutés à une conversation.


**Headers requis:**
```
Authorization: Bearer <access_token>
```


**Réponse réussie (200 OK):**
```json
[
  {
    "uuid": "123e4567-e89b-12d3-a456-426614174000",
    "name": "Assistant Marketing",
    "description": "Agent spécialisé dans le marketing",
    "avatar": "http://example.com/media/agents/avatars/agent1.jpg",
    "agent_type": "simple",
    "is_active": true,
    "created_at": "2025-10-10T14:30:00Z",
    "created_by_username": "john_doe",
    "conversation_count": 3
  }
]
```


---


### 17. Types d'agents disponibles


**Endpoint:** `GET /agents/agents/types/`


**Description:** Récupère la liste des types d'agents disponibles dans le système.


**Headers requis:**
```
Authorization: Bearer <access_token>
```


**Réponse réussie (200 OK):**
```json
[
  {
    "value": "simple",
    "label": "Agent Simple"
  },
  {
    "value": "conditional",
    "label": "Agent Conditionnel"
  },
  {
    "value": "action",
    "label": "Agent d'Action"
  }
]
```


---


### 18. Statistiques d'un agent


**Endpoint:** `GET /agents/agents/{uuid}/stats/`


**Description:** Récupère les statistiques d'utilisation d'un agent.


**Headers requis:**
```
Authorization: Bearer <access_token>
```


**Paramètres URL:**
- `uuid`: UUID de l'agent


**Réponse réussie (200 OK):**
```json
{
  "total_responses": 127,
  "successful_responses": 122,
  "failed_responses": 5,
  "active_conversations": 3,
  "avg_processing_time": 1.45,
  "created_at": "2025-10-10T14:30:00Z",
  "last_response": "2025-10-13T09:15:00Z"
}
```


**Champs de réponse:**
- `total_responses`: Nombre total de réponses générées
- `successful_responses`: Nombre de réponses envoyées avec succès
- `failed_responses`: Nombre de réponses qui ont échoué
- `active_conversations`: Nombre de conversations où l'agent est actif
- `avg_processing_time`: Temps moyen de traitement en secondes
- `created_at`: Date de création de l'agent
- `last_response`: Date de la dernière réponse (`null` si aucune)


---


### 19. Tester un agent


**Endpoint:** `POST /agents/agents/{uuid}/test/`


**Description:** Teste un agent avec un message fictif sans l'ajouter à une vraie conversation.


**Headers requis:**
```
Authorization: Bearer <access_token>
Content-Type: application/json
```


**Paramètres URL:**
- `uuid`: UUID de l'agent


**Body (JSON):**
```json
{
  "message": "Bonjour, peux-tu m'aider ?"
}
```


**Champs obligatoires:**
- `message` (string): Message de test


**Réponse réussie (200 OK):**
```json
{
  "agent_name": "Assistant Marketing",
  "test_message": "Bonjour, peux-tu m'aider ?",
  "response": "Bien sûr ! Je suis là pour vous aider. Que puis-je faire pour vous ?",
  "success": true,
  "processing_time": 1.23,
  "error": null
}
```


**Réponse en cas d'erreur (200 OK avec success: false):**
```json
{
  "agent_name": "Assistant Marketing",
  "test_message": "Bonjour, peux-tu m'aider ?",
  "response": "Erreur de génération",
  "success": false,
  "processing_time": 2.5,
  "error": "Timeout API Mistral"
}
```


**Erreurs possibles:**
- `400 Bad Request`: Message manquant ou agent inactif
- `404 Not Found`: Agent introuvable
- `403 Forbidden`: Pas le créateur de l'agent


---


## Modèles de données


### Agent
```json
{
  "uuid": "uuid",
  "name": "string (max 100 caractères)",
  "description": "string (max 500 caractères)",
  "avatar": "url ou null",
  "agent_type": "simple | conditional | action",
  "is_active": "boolean",
  "created_at": "datetime",
  "updated_at": "datetime",
  "created_by": "id utilisateur"
}
```


### AgentInstructions
```json
{
  "system_prompt": "string",
  "language": "fr | en | es | de | it",
  "formality_level": "formal | casual | friendly | professional",
  "max_response_length": "integer",
  "created_at": "datetime",
  "updated_at": "datetime"
}
```


### AgentInteraction
```json
{
  "id": "integer",
  "agent": "id agent",
  "interaction_type": "respond_to | ignore | mention_only | always_respond",
  "target_user": "id utilisateur ou null",
  "target_agent": "id agent ou null",
  "created_at": "datetime"
}
```


### AgentResponse
```json
{
  "id": "integer",
  "agent": "id agent",
  "conversation": "id conversation",
  "triggered_by_message": "id message ou null",
  "response_content": "string",
  "processing_time": "float (secondes)",
  "created_at": "datetime",
  "was_sent": "boolean",
  "error_message": "string"
}
```


---


## Codes d'erreur


| Code | Description |
|------|-------------|
| 200  | Succès |
| 201  | Ressource créée |
| 204  | Succès sans contenu |
| 400  | Requête invalide (données incorrectes) |
| 401  | Non authentifié (token manquant/invalide) |
| 403  | Accès refusé (permissions insuffisantes) |
| 404  | Ressource introuvable |
| 500  | Erreur serveur |


---


## Notes importantes


- **Limite d'agents par conversation:** Maximum 5 agents actifs par conversation
- **Règles d'interaction:** Une règle ne peut cibler qu'un utilisateur OU un agent, pas les deux
- **Utilisation d'UUID:** Les règles d'interaction utilisent maintenant les UUID pour cibler les utilisateurs et agents (et non les ID)
- **Suppression d'agents:** La suppression désactive l'agent (`is_active = false`) plutôt que de le supprimer définitivement
- **Unicité des règles:** Un agent ne peut avoir qu'une seule règle par cible (utilisateur ou agent)
- **Permissions:** Seul le créateur d'un agent peut le modifier, le supprimer ou accéder à ses détails
- **IA utilisée:** Les agents utilisent l'API Mistral AI pour générer leurs réponses
- **Contexte conversationnel:** Les agents ont accès aux 5 derniers messages de la conversation pour générer leurs réponses
- **Déclenchement automatique:** Les agents sont déclenchés automatiquement via Django signals quand un nouveau message est créé dans une conversation où ils sont présents
- **WebSocket:** Les réponses des agents sont envoyées en temps réel via WebSocket


---


## Exemples d'utilisation


### Créer un agent simple
```bash
curl -X POST https://votre-domaine.com/agents/ \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Assistant Personnel",
    "description": "Mon assistant qui répond à mes questions",
    "agent_type": "simple",
    "instructions": {
      "system_prompt": "Tu es un assistant personnel serviable.",
      "language": "fr",
      "formality_level": "friendly"
    }
  }'
```


### Ajouter un agent à une conversation
```bash
curl -X POST https://votre-domaine.com/conversations/123e4567-e89b-12d3-a456-426614174000/agents/add/ \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "agent_uuid": "345e6789-e89b-12d3-a456-426614174002"
  }'
```


### Créer une règle d'interaction avec UUID
```bash
curl -X POST https://votre-domaine.com/agents/345e6789-e89b-12d3-a456-426614174002/interactions/ \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "interaction_type": "always_respond",
    "target_user_uuid": "474df5b3-b4e4-46bb-ae54-57eb9365e37d"
  }'
```


---


**Documentation générée le 14 octobre 2025**










































































Documentation API - Module Jarvis
Vue d'ensemble
Le module Jarvis est un assistant intelligent qui permet aux utilisateurs d'interagir avec leur compte via langage naturel. Jarvis utilise l'API Mistral pour comprendre les intentions de l'utilisateur et exécuter des actions en son nom.
Base URL: /jarvis/
Authentication: Toutes les routes requièrent un token JWT Bearer dans le header Authorization: Bearer {token}
________________


Endpoints disponibles
1. Instance Jarvis
GET /jarvis/instance/
Récupère les informations de l'instance Jarvis de l'utilisateur connecté. Si l'instance n'existe pas, elle est créée automatiquement.
Authentication: Requise
Query Parameters: Aucun
Request Body: Aucun
Response (200 OK):
{
  "uuid": "550e8400-e29b-41d4-a716-446655440000",
  "user": 1,
  "user_username": "john_doe",
  "user_preferences": {
    "language": "fr",
    "notifications": true
  },
  "is_active": true,
  "default_language": "fr",
  "total_requests": 42,
  "total_actions_performed": 15,
  "last_interaction": "2025-10-13T14:30:00Z",
  "created_at": "2025-10-01T10:00:00Z",
  "updated_at": "2025-10-13T14:30:00Z",
  "learned_patterns": {},
  "api_rate_limit": 100
}


Champs:
* uuid (string): Identifiant unique de l'instance Jarvis
* user (integer): ID de l'utilisateur
* user_username (string): Nom d'utilisateur
* user_preferences (object): Préférences personnalisées de l'utilisateur
* is_active (boolean): Indique si Jarvis est actif pour cet utilisateur
* default_language (string): Langue par défaut ("fr" ou "en")
* total_requests (integer): Nombre total de requêtes effectuées
* total_actions_performed (integer): Nombre total d'actions exécutées avec succès
* last_interaction (datetime): Date de la dernière interaction
* created_at (datetime): Date de création de l'instance
* updated_at (datetime): Date de dernière mise à jour
* learned_patterns (object): Patterns comportementaux appris
* api_rate_limit (integer): Limite de requêtes par jour
________________


PUT/PATCH /jarvis/instance/
Met à jour les paramètres de l'instance Jarvis de l'utilisateur.
Authentication: Requise
Query Parameters: Aucun
Request Body:
{
  "user_preferences": {
    "language": "en",
    "notifications": false
  },
  "is_active": true,
  "default_language": "en",
  "learned_patterns": {},
  "api_rate_limit": 150
}


Champs modifiables:
* user_preferences (object, optionnel): Préférences utilisateur
* is_active (boolean, optionnel): Activer/désactiver Jarvis
* default_language (string, optionnel): Langue par défaut
* learned_patterns (object, optionnel): Patterns d'apprentissage
* api_rate_limit (integer, optionnel): Limite de requêtes journalières
Response (200 OK): Même structure que GET
________________


2. Chat avec Jarvis
POST /jarvis/chat/?type={type}
Point d'entrée principal pour interagir avec Jarvis. Le comportement dépend du paramètre type.
Authentication: Requise
Query Parameters:
* type (string, obligatoire): Type d'interaction
   * "welcome": Message de bienvenue pour un nouvel utilisateur
   * "notifications": Récupération et résumé des notifications
   * "message": Conversation normale avec Jarvis
________________


POST /jarvis/chat/?type=welcome
Génère un message de bienvenue personnalisé pour l'utilisateur.
Request Body:
{
  "message": "Bonjour, je suis nouveau",
  "context": {}
}


Champs (tous optionnels):
* message (string, optionnel): Message personnalisé de l'utilisateur. Si absent, un message par défaut est généré.
* context (object, optionnel): Contexte additionnel
Response (200 OK):
{
  "response": "Bienvenue sur Echo ! Je suis Jarvis, votre assistant personnel. Je suis là pour vous aider à naviguer sur la plateforme...",
  "action_performed": "chat",
  "data": {},
  "timestamp": "2025-10-13T14:30:00Z",
  "success": true
}


Erreurs possibles:
* 403 Forbidden: Jarvis est désactivé pour ce compte
* 500 Internal Server Error: Erreur lors du traitement
________________


POST /jarvis/chat/?type=notifications
Jarvis analyse et résume les notifications de l'utilisateur sous forme de JSON structuré.
Request Body: Aucun (le body peut être vide)
Response (200 OK):
{
  "response": "{\"notifications\": [{\"conversation_uuid\": \"abc-123\", \"username\": \"Antoine\", \"unread_count\": 4, \"summary\": \"Antoine t'invite à dîner ce soir\"}, {\"conversation_uuid\": \"def-456\", \"username\": \"Sophie\", \"unread_count\": 1, \"summary\": \"Sophie demande comment tu vas\"}], \"total_unread\": 5}",
  "action_performed": "chat",
  "data": {
    "notifications": [
      {
        "conversation_uuid": "abc-123",
        "username": "Antoine",
        "unread_count": 4,
        "summary": "Antoine t'invite à dîner ce soir"
      },
      {
        "conversation_uuid": "def-456",
        "username": "Sophie",
        "unread_count": 1,
        "summary": "Sophie demande comment tu vas"
      }
    ],
    "total_unread": 5
  },
  "timestamp": "2025-10-13T14:30:00Z",
  "success": true
}


Structure du champ data:
* notifications (array): Liste des conversations avec messages non lus
   * conversation_uuid (string): UUID de la conversation
   * username (string): Nom de l'utilisateur avec qui vous discutez
   * unread_count (integer): Nombre de messages non lus dans cette conversation
   * summary (string): Résumé du contenu en une phrase courte (10-15 mots)
* total_unread (integer): Nombre total de messages non lus
Note importante: Le champ response contient le JSON sous forme de chaîne de caractères. Pour une utilisation plus pratique, utilisez le champ data qui contient déjà l'objet JSON parsé.
Erreurs possibles:
* 403 Forbidden: Jarvis est désactivé pour ce compte
* 500 Internal Server Error: Erreur lors du traitement
________________


POST /jarvis/chat/?type=message
Conversation normale avec Jarvis. L'utilisateur peut poser des questions ou demander des actions.
Request Body (obligatoire):
{
  "message": "Montre-moi mes messages non lus",
  "context": {}
}


Champs:
* message (string, obligatoire): Message de l'utilisateur (2-5000 caractères)
* context (object, optionnel): Contexte additionnel
Response (200 OK):
{
  "response": "Message envoyé à Alice : 'J'arrive dans 10 minutes'",
  "action_performed": "chat",
  "data": {},
  "timestamp": "2025-10-13T14:30:00Z",
  "success": true
}


Note: Après l'exécution d'une action (comme l'envoi d'un message), Jarvis confirme toujours ce qui a été fait. Le champ response contient une confirmation en langage naturel de l'action effectuée.
Exemples de messages que Jarvis peut traiter:
* "Montre-moi mes messages non lus"
* "Envoie un message à Alice pour lui dire que j'arrive"
* "Marque ma conversation avec Bob comme lue"
* "Liste mes conversations récentes"
Actions que Jarvis peut exécuter automatiquement:
* Récupérer les messages non lus
* Lire les messages d'une conversation spécifique
* Envoyer des messages au nom de l'utilisateur
* Marquer des conversations comme lues
* Lister les conversations
Erreurs possibles:
* 400 Bad Request: Message invalide (vide ou trop court)
* 403 Forbidden: Jarvis est désactivé pour ce compte
* 500 Internal Server Error: Erreur lors du traitement
________________


3. Logs d'actions
GET /jarvis/logs/
Liste tous les logs d'actions effectuées par Jarvis pour l'utilisateur connecté.
Authentication: Requise
Query Parameters:
* action_type (string, optionnel): Filtrer par type d'action
   * Valeurs possibles: "read_messages", "send_message", "list_conversations", "summarize", "update_preferences", "search", "mark_as_read", "archive", "other"
* success (boolean, optionnel): Filtrer par statut de succès (true ou false)
* limit (integer, optionnel): Nombre maximum de résultats (défaut: 50)
Exemple:
GET /jarvis/logs/?action_type=send_message&success=true&limit=10


Response (200 OK):
[
  {
    "uuid": "660e8400-e29b-41d4-a716-446655440000",
    "jarvis_instance": 1,
    "action_type": "send_message",
    "action_type_display": "Envoi de message",
    "action_description": "Envoi d'un message dans la conversation avec Alice",
    "endpoint_called": "/messaging/conversations/abc123/messages/",
    "http_method": "POST",
    "request_payload": {
      "conversation_uuid": "abc123",
      "content": "Salut Alice, je serai là à 15h"
    },
    "response_status": 201,
    "user_query": "Envoie un message à Alice pour lui dire que je serai là à 15h",
    "llm_interpretation": {
      "function": "send_message",
      "args": {
        "conversation_uuid": "abc123",
        "content": "Salut Alice, je serai là à 15h"
      }
    },
    "success": true,
    "error_message": "",
    "processing_time": 1.23,
    "created_at": "2025-10-13T14:30:00Z"
  }
]


Champs:
* uuid (string): Identifiant unique du log
* jarvis_instance (integer): ID de l'instance Jarvis
* action_type (string): Type d'action technique
* action_type_display (string): Libellé lisible du type d'action
* action_description (string): Description de l'action effectuée
* endpoint_called (string): URL de l'API appelée
* http_method (string): Méthode HTTP utilisée (GET, POST, etc.)
* request_payload (object): Données envoyées dans la requête
* response_status (integer): Code HTTP de la réponse (200, 201, 404, etc.)
* user_query (string): Message original de l'utilisateur
* llm_interpretation (object): Interprétation de l'intention par Mistral AI
* success (boolean): Indique si l'action a réussi
* error_message (string): Message d'erreur le cas échéant
* processing_time (float): Temps de traitement en secondes
* created_at (datetime): Date de création du log
________________


4. Historique des conversations
GET /jarvis/history/
Récupère l'historique complet des conversations entre l'utilisateur et Jarvis.
Authentication: Requise
Query Parameters:
* limit (integer, optionnel): Nombre maximum de messages à retourner (défaut: 50)
Exemple:
GET /jarvis/history/?limit=20


Response (200 OK):
[
  {
    "uuid": "770e8400-e29b-41d4-a716-446655440000",
    "user_message": "Montre-moi mes messages non lus",
    "jarvis_response": "Vous avez 3 messages non lus. Voici les détails:\n- Message de Alice: 'Salut, ça va ?'\n- Message de Bob: 'Rendez-vous à 15h'\n- Message de Charlie: 'Merci pour ton aide'",
    "related_action": {
      "uuid": "660e8400-e29b-41d4-a716-446655440000",
      "action_type": "read_messages",
      "action_type_display": "Lecture de messages",
      "success": true,
      "created_at": "2025-10-13T14:30:00Z"
    },
    "created_at": "2025-10-13T14:30:00Z"
  },
  {
    "uuid": "880e8400-e29b-41d4-a716-446655440000",
    "user_message": "Bonjour Jarvis",
    "jarvis_response": "Bonjour ! Comment puis-je vous aider aujourd'hui ?",
    "related_action": null,
    "created_at": "2025-10-13T14:25:00Z"
  }
]


Champs:
* uuid (string): Identifiant unique de l'entrée d'historique
* user_message (string): Message envoyé par l'utilisateur
* jarvis_response (string): Réponse de Jarvis
* related_action (object|null): Log d'action associé si une action a été effectuée
* created_at (datetime): Date de l'échange
________________


5. Statistiques
GET /jarvis/stats/
Fournit des statistiques détaillées sur l'utilisation de Jarvis par l'utilisateur.
Authentication: Requise
Query Parameters: Aucun
Response (200 OK):
{
  "total_requests": 42,
  "total_actions_performed": 15,
  "total_logs": 15,
  "successful_actions": 14,
  "failed_actions": 1,
  "success_rate": 93.33,
  "last_interaction": "2025-10-13T14:30:00Z",
  "actions_by_type": [
    {
      "action_type": "read_messages",
      "count": 8
    },
    {
      "action_type": "send_message",
      "count": 4
    },
    {
      "action_type": "list_conversations",
      "count": 2
    },
    {
      "action_type": "other",
      "count": 1
    }
  ],
  "is_active": true,
  "api_rate_limit": 100
}


Champs:
* total_requests (integer): Nombre total de requêtes à Jarvis
* total_actions_performed (integer): Nombre total d'actions exécutées avec succès
* total_logs (integer): Nombre total de logs enregistrés
* successful_actions (integer): Nombre d'actions réussies
* failed_actions (integer): Nombre d'actions échouées
* success_rate (float): Taux de succès en pourcentage
* last_interaction (datetime): Date de la dernière interaction
* actions_by_type (array): Répartition des actions par type, triée par ordre décroissant de fréquence
* is_active (boolean): Statut actif de Jarvis
* api_rate_limit (integer): Limite de requêtes par jour
________________


Fonctionnalités de Jarvis
Jarvis dispose de plusieurs fonctions qu'il peut exécuter automatiquement en fonction des demandes de l'utilisateur :
Fonctions disponibles
1. get_unread_messages: Récupère tous les messages non lus
2. get_conversation_messages: Récupère les messages d'une conversation spécifique
3. send_message: Envoie un message au nom de l'utilisateur
4. mark_conversation_as_read: Marque une conversation comme lue
5. get_conversations: Liste toutes les conversations de l'utilisateur
Ces fonctions sont appelées automatiquement par Jarvis lorsqu'il détecte l'intention de l'utilisateur via Mistral AI.
________________


Codes d'erreur
Erreurs communes
400 Bad Request
{
  "message": [
    "Le message ne peut pas être vide."
  ]
}


Le message envoyé est invalide (vide, trop court, ou format incorrect).
403 Forbidden
{
  "error": "Jarvis est désactivé pour votre compte."
}


L'instance Jarvis de l'utilisateur est désactivée (is_active = false).
500 Internal Server Error
{
  "error": "Une erreur est survenue lors du traitement de votre demande.",
  "detail": "Description détaillée de l'erreur"
}


Erreur serveur lors du traitement de la requête (problème avec l'API Mistral, erreur réseau, etc.).
Missing type parameter
{
  "error": "Une erreur est survenue lors du traitement de votre demande.",
  "detail": "Il faut un type pour Jarvis parmi welcome ; notifications ; message"
}


Le paramètre type est manquant dans l'URL pour l'endpoint /jarvis/chat/.
________________


Notes d'implémentation
Authentication
Toutes les routes nécessitent un token JWT valide dans le header:
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...


Rate Limiting
Chaque utilisateur a une limite de requêtes par jour configurée dans api_rate_limit (défaut: 100). Cette limite est gérée au niveau de l'instance Jarvis.
Langues supportées
* Français ("fr")
* Anglais ("en")
La langue par défaut est configurée dans default_language de l'instance Jarvis.
Traitement asynchrone
Les requêtes à Jarvis peuvent prendre plusieurs secondes car elles impliquent:
1. Analyse du message par Mistral AI
2. Exécution potentielle de plusieurs appels API
3. Génération de la réponse finale
Le temps de traitement est enregistré dans le champ processing_time des logs.
________________


Exemples d'utilisation
Exemple 1: Message de bienvenue
Request:
POST /jarvis/chat/?type=welcome
Authorization: Bearer {token}
Content-Type: application/json


{}


Response:
{
  "response": "Bienvenue john_doe sur Echo ! Je suis Jarvis, votre assistant personnel...",
  "action_performed": "chat",
  "data": {},
  "timestamp": "2025-10-13T14:30:00Z",
  "success": true
}


Exemple 2: Consultation des notifications
Request:
POST /jarvis/chat/?type=notifications
Authorization: Bearer {token}
Content-Type: application/json


{}


Response:
{
  "response": "{\"notifications\": [{\"conversation_uuid\": \"abc-123\", \"username\": \"Antoine\", \"unread_count\": 4, \"summary\": \"Antoine t'invite à dîner ce soir\"}, {\"conversation_uuid\": \"def-456\", \"username\": \"Sophie\", \"unread_count\": 1, \"summary\": \"Sophie demande comment tu vas\"}], \"total_unread\": 5}",
  "action_performed": "chat",
  "data": {
    "notifications": [
      {
        "conversation_uuid": "abc-123",
        "username": "Antoine",
        "unread_count": 4,
        "summary": "Antoine t'invite à dîner ce soir"
      },
      {
        "conversation_uuid": "def-456",
        "username": "Sophie",
        "unread_count": 1,
        "summary": "Sophie demande comment tu vas"
      }
    ],
    "total_unread": 5
  },
  "timestamp": "2025-10-13T14:30:00Z",
  "success": true
}


Exemple 3: Lecture des messages non lus
Request:
POST /jarvis/chat/?type=message
Authorization: Bearer {token}
Content-Type: application/json


{
  "message": "Montre-moi mes messages non lus"
}


Response:
{
  "response": "Vous avez 3 messages non lus:\n- Alice: 'Salut, ça va ?'\n- Bob: 'Rendez-vous à 15h'\n- Charlie: 'Merci pour ton aide'",
  "action_performed": "chat",
  "data": {},
  "timestamp": "2025-10-13T14:30:00Z",
  "success": true
}


Exemple 4: Envoi d'un message
Request:
POST /jarvis/chat/?type=message
Authorization: Bearer {token}
Content-Type: application/json


{
  "message": "Envoie un message à Alice pour lui dire que j'arrive dans 10 minutes"
}


Response:
{
  "response": "Message envoyé à Alice : 'J'arrive dans 10 minutes'",
  "action_performed": "chat",
  "data": {},
  "timestamp": "2025-10-13T14:30:00Z",
  "success": true
}


Exemple 5: Consultation des statistiques
Request:
GET /jarvis/stats/
Authorization: Bearer {token}


Response:
{
  "total_requests": 42,
  "total_actions_performed": 15,
  "total_logs": 15,
  "successful_actions": 14,
  "failed_actions": 1,
  "success_rate": 93.33,
  "last_interaction": "2025-10-13T14:30:00Z",
  "actions_by_type": [
    {
      "action_type": "read_messages",
      "count": 8
    }
  ],
  "is_active": true,
  "api_rate_limit": 100
}


Exemple 5: Désactivation de Jarvis
Request:
PATCH /jarvis/instance/
Authorization: Bearer {token}
Content-Type: application/json


{
  "is_active": false
}


Response:
{
  "uuid": "550e8400-e29b-41d4-a716-446655440000",
  "user": 1,
  "user_username": "john_doe",
  "user_preferences": {},
  "is_active": false,
  "default_language": "fr",
  "total_requests": 42,
  "total_actions_performed": 15,
  "last_interaction": "2025-10-13T14:30:00Z",
  "created_at": "2025-10-01T10:00:00Z",
  "updated_at": "2025-10-13T14:35:00Z",
  "learned_patterns": {},
  "api_rate_limit": 100
}


________________


Résumé des routes
Méthode
	Endpoint
	Description
	Auth requise
	GET
	/jarvis/instance/
	Récupère l'instance Jarvis
	Oui
	PUT/PATCH
	/jarvis/instance/
	Met à jour l'instance Jarvis
	Oui
	POST
	/jarvis/chat/?type=welcome
	Message de bienvenue
	Oui
	POST
	/jarvis/chat/?type=notifications
	Résumé des notifications
	Oui
	POST
	/jarvis/chat/?type=message
	Conversation avec Jarvis
	Oui
	GET
	/jarvis/logs/
	Liste les logs d'actions
	Oui
	GET
	/jarvis/history/
	Historique des conversations
	Oui
	GET
	/jarvis/stats/
	Statistiques d'utilisation
	Oui